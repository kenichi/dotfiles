# Database Setup

1. install PostgreSQL
2. install PROJ4
3. install GEOS
4. install PostGIS

### Installing PostgreSQL database

Download the [source](http://ftp.postgresql.org/pub/source/v9.2.1/postgresql-9.2.1.tar.bz2), extract, then:

```bash
./configure --prefix=/usr/local --with-openssl
make

```

### Installing PROJ4

Download the [package](http://download.osgeo.org/proj/proj-4.8.0.tar.gz), extract, then:

```bash
./configure --prefix=/usr/local --enable-shared
make
sudo make install
```

### Installing PCRE

Download the [package](http://voxel.dl.sourceforge.net/project/pcre/pcre/8.31/pcre-8.31.tar.bz2), extract, then:

```bash
./configure --prefix=/usr/local
make
sudo make install
```

### Installing SWIG

Download the [package](http://hivelocity.dl.sourceforge.net/project/swig/swig/swig-2.0.8/swig-2.0.8.tar.gz), extract, then:

```bash
./configure --prefix=/usr/local
make
sudo make install
```

### Installing GEOS

See the [GCC](GccDevSetup.md) file for instructions on building a new GCC. Then, make sure that compiler comes first in your path:

```bash
export PATH=/opt/gcc/current/bin:$PATH
```

Download the [package](http://download.osgeo.org/geos/geos-3.3.5.tar.bz2), extract, then:

```bash
export CFLAGS='-DHAVE_STRUCT_TIMESPEC -I/opt/ruby/1.9.3-p286/include/ruby-1.9.1'
export CPPFLAGS='-DHAVE_STRUCT_TIMESPEC -I/opt/ruby/1.9.3-p286/include/ruby-1.9.1'
export LDFLAGS='-L/opt/ruby/1.9.3-p286/lib'
./configure --prefix=/usr/local --enable-shared --enable-python --enable-ruby
make
```

In `geos_wrap.cxx` was processed by swig and had a bad struct access on line 7878. ruby 1.8 `RArray` structs had a `len`
member, but 1.9 moved this inside a `heap` struct inside an `as` union. pre-patching doesn't help since the file is
regenerated by swig. So, go find this around line 7878. If you can't find it there, search for `RARRAY` macro usage.

__TODO: revisit this and see if my `swig` was built wrong__

```diff
--- a/swig/ruby/geos_wrap.cxx
+++ b/swig/ruby/geos_wrap.cxx

         /* Get the length */
-        arg3 = RARRAY(argv[1])->len;
+        arg3 = RARRAY(argv[1])->as.heap.len;

         /* Allocate space for the C array. */
```


```bash
make
sudo make install
unset CFLAGS CPPFLAGS LDFLAGS
```

__Remember to reset your PATH__

### Installing GNU gettext

Download the [package](http://ftp.gnu.org/gnu/gettext/gettext-0.18.1.1.tar.gz), extract, then:

```diff
diff --git a/gettext-tools/gnulib-lib/stpncpy.c b/gettext-tools/gnulib-lib/stpncpy.c
index ca53ebb..b51b688 100644
--- a/gettext-tools/gnulib-lib/stpncpy.c
+++ b/gettext-tools/gnulib-lib/stpncpy.c
@@ -31,7 +31,7 @@
 /* Copy no more than N bytes of SRC to DST, returning a pointer past the
    last non-NUL byte written into DST.  */
 char *
-__stpncpy (char *dest, const char *src, size_t n)
+__stpcpy (char *dest, const char *src, size_t n)
 {
   char c;
   char *s = dest;
```

```bash
./configure --prefix=/usr/local --with-libiconv-prefix=/usr/local --with-ncurses-prefix=/usr/local
make
sudo make install
```

### Installing JSON-C

Clone the github repo and build:

```bash
git clone https://github.com/json-c/json-c.git
cd json-c
./configure --prefix=/usr/local --enable-shared
sudo make install
```

### Installing GDAL

__TODO__

### Installing PostGIS extensions

Download the [package](http://postgis.refractions.net/download/postgis-2.0.1.tar.gz), extract, then:

```bash
```
